<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Knight's Tour 5Ã—5 â€” Game + Auto Generator</title>
  <meta name="description" content="Play Knight's Tour on a 5x5 board with manual moves, hints, undo, timer, and an auto-solver. Single-file, Vercel/GitHub Pages ready." />
  <style>
    :root {
      --bg: #0a0f1f;
      --panel: #0f162e;
      --accent: #6f57ff;
      --accent-2: #36d399;
      --text: #e8edf6;
      --muted: #9aa6bf;
      --square: #121a35;
      --square-alt: #0f213c;
      --bad: #ff7070;
      --good: #39d98a;
      --warn: #ffe082;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; color:var(--text); background: radial-gradient(1200px 800px at 10% -10%, #1a2550 0%, var(--bg) 45%); display:grid;place-items:center;padding:20px}
    .app{width:min(1080px,96vw)}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.06); border-radius:20px; box-shadow:0 20px 50px rgba(0,0,0,.35); overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;border-bottom:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg, rgba(15,22,42,.8), rgba(15,22,42,.35))}
    h1{margin:0;font-size:clamp(18px,2.4vw,26px)}
    .sub{color:var(--muted);font-size:12px}

    .wrap{display:grid;grid-template-columns:1fr 340px;gap:18px;padding:18px}
    @media (max-width: 900px){ .wrap{grid-template-columns:1fr} }

    .board{aspect-ratio:1/1; display:grid; grid-template-columns:repeat(5,1fr); grid-template-rows:repeat(5,1fr); border:1px solid rgba(255,255,255,.1); background:#0d1330; border-radius:16px; overflow:hidden; position:relative}
    .sq{position:relative; display:grid; place-items:center; user-select:none; font-weight:700; font-variant-numeric:tabular-nums; cursor:pointer}
    .sq:nth-child(odd){background:var(--square)}
    .sq:nth-child(even){background:var(--square-alt)}
    .sq .num{position:absolute; bottom:6px; right:8px; font-size:11px; color:var(--muted)}
    .sq.valid::after{content:""; position:absolute; inset:6px; border:2px dashed rgba(255,255,255,.18); border-radius:12px}
    .sq.bad{animation: shake .25s linear; outline:2px solid var(--bad)}
    @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-2px)}60%{transform:translateX(2px)}}

    .knight{width:70%; aspect-ratio:1/1; display:grid; place-items:center; font-size:clamp(28px,6vw,56px)}

    .panel{background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:14px; display:grid; gap:12px}
    .statrow{display:flex;flex-wrap:wrap;gap:8px}
    .badge{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);font-size:12px}

    button, select{background:#0f1530;color:var(--text);border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:10px 12px; font-weight:700; letter-spacing:.2px; cursor:pointer; transition:.15s ease;}
    button:hover{background:#121a3a}
    .primary{background:linear-gradient(180deg,#6f57ff,#563bff);border:none}
    .success{background:#0f2a23;border-color:rgba(57,217,138,.45)}
    .danger{background:#2a1121;border-color:rgba(255,112,112,.45)}
    .ghost{background:transparent}

    .footer{padding:12px 16px; color:var(--muted); font-size:12px; border-top:1px solid rgba(255,255,255,.06); display:flex; gap:8px; flex-wrap:wrap; justify-content:space-between}

    .toast{position:fixed; bottom:16px; left:50%; transform:translateX(-50%); background:#0b1436; border:1px solid rgba(255,255,255,.12); padding:10px 14px; border-radius:12px; font-size:14px; display:none}
    .show{display:block}

    .path{position:absolute; inset:0; pointer-events:none}
    svg path{stroke:var(--accent); stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round; opacity:.9}
  </style>
</head>
<body>
  <div class="app card">
    <header>
      <div>
        <h1>Knight's Tour â€” 5Ã—5 Game</h1>
        <div class="sub">Manual play with hints, undo & timer â€” or let the auto-solver generate a tour and watch the knight run!</div>
      </div>
      <div class="statrow">
        <span class="badge" id="b-steps">Steps: 0/25</span>
        <span class="badge" id="b-time">Time: 00:00</span>
        <span class="badge" id="b-best">Best: â€”</span>
        <span class="badge" id="b-mode">Mode: Manual</span>
      </div>
    </header>

    <div class="wrap">
      <div class="board" id="board" aria-label="5 by 5 chessboard"></div>
      <aside class="panel">
        <div class="statrow">
          <button class="primary" id="btn-new">New Game</button>
          <button id="btn-hint">Hint</button>
          <button id="btn-undo">Undo</button>
          <button class="danger" id="btn-reset">Reset</button>
        </div>
        <div class="statrow">
          <button class="success" id="btn-auto">Auto Generate</button>
          <button id="btn-play">Play Auto Path</button>
          <button id="btn-stop">Stop</button>
        </div>
        <div class="statrow">
          <label class="badge" style="display:flex;align-items:center;gap:8px">Speed
            <input type="range" id="speed" min="30" max="800" value="220" />
          </label>
          <select id="strategy">
            <option value="warnsdorff" selected>Warnsdorff + BT</option>
            <option value="backtrack">Pure Backtracking</option>
          </select>
          <button id="btn-sound" class="ghost">ðŸ”ˆ Sound: On</button>
        </div>
        <div id="status" class="sub">Click any square to place your knight and start.</div>
      </aside>
    </div>

    <div class="footer">
      <span>Rule: Move in an L-shape (2+1). Visit all 25 squares exactly once.</span>
      <span>Single file. Deploy to <strong>Vercel</strong> or GitHub Pages.</span>
    </div>
  </div>

  <div id="toast" class="toast"></div>
  <svg class="path" id="path" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true"></svg>

  <script>
    // --- Game state ---
    const N = 5;
    const MOVES = [[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]];

    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');
    const pathSVG = document.getElementById('path');
    const toastEl = document.getElementById('toast');

    const btnNew = document.getElementById('btn-new');
    const btnHint = document.getElementById('btn-hint');
    const btnUndo = document.getElementById('btn-undo');
    const btnReset = document.getElementById('btn-reset');
    const btnAuto = document.getElementById('btn-auto');
    const btnPlay = document.getElementById('btn-play');
    const btnStop = document.getElementById('btn-stop');
    const speedEl = document.getElementById('speed');
    const strategyEl = document.getElementById('strategy');
    const btnSound = document.getElementById('btn-sound');

    const bSteps = document.getElementById('b-steps');
    const bTime = document.getElementById('b-time');
    const bBest = document.getElementById('b-best');
    const bMode = document.getElementById('b-mode');

    let squares = [];
    let visit = []; // -1 unvisited, otherwise step index
    let path = []; // {r,c}
    let current = null; // {r,c}
    let animating = false;
    let startTime = 0, timerId = null;
    let autoSolution = [];
    let soundOn = true;

    // --- Sound (beeps) ---
    let ac; // AudioContext
    function beep(freq=660, dur=0.06, vol=0.03){
      if(!soundOn) return;
      try{
        ac = ac || new (window.AudioContext||window.webkitAudioContext)();
        const o = ac.createOscillator();
        const g = ac.createGain();
        o.frequency.value = freq; o.type = 'sine';
        g.gain.value = vol; o.connect(g); g.connect(ac.destination);
        o.start(); o.stop(ac.currentTime + dur);
      }catch{}
    }

    // --- Utilities ---
    function idx(r,c){ return r*N + c; }
    function inBounds(r,c){ return r>=0 && r<N && c>=0 && c<N; }
    function legalMoves(r,c){
      const m=[]; for(const [dr,dc] of MOVES){ const nr=r+dr, nc=c+dc; if(inBounds(nr,nc) && visit[idx(nr,nc)]===-1) m.push({r:nr,c:nc}); }
      return m;
    }
    function formatTime(ms){ const s=Math.floor(ms/1000); const m=Math.floor(s/60); const ss=String(s%60).padStart(2,'0'); const mm=String(m).padStart(2,'0'); return `${mm}:${ss}`; }

    function showToast(msg){ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=> toastEl.classList.remove('show'), 1200); }

    function status(msg){ statusEl.textContent = msg; }

    function updateHUD(){ bSteps.textContent = `Steps: ${path.length}/${N*N}`; if(startTime){ bTime.textContent = `Time: ${formatTime(Date.now()-startTime)}` } else { bTime.textContent='Time: 00:00' } }

    function saveBest(){ if(path.length===N*N){ const t=Date.now()-startTime; const best= +localStorage.getItem('kt5_best_time') || Infinity; if(t<best){ localStorage.setItem('kt5_best_time', String(t)); } renderBest(); } }
    function renderBest(){ const best= +localStorage.getItem('kt5_best_time'); bBest.textContent = isFinite(best)? `Best: ${formatTime(best)}` : 'Best: â€”'; }

    function clearHighlights(){ squares.forEach(s=> s.classList.remove('valid','bad')); }

    function drawBoard(){
      boardEl.innerHTML=''; squares=[]; visit = Array(N*N).fill(-1); path=[]; current=null; autoSolution=[]; drawPath([]);
      for(let r=0;r<N;r++) for(let c=0;c<N;c++){
        const d=document.createElement('div'); d.className='sq'; d.dataset.r=r; d.dataset.c=c;
        const n=document.createElement('div'); n.className='num'; n.textContent=''; d.appendChild(n);
        const k=document.createElement('div'); k.className='knight'; k.textContent=''; d.appendChild(k);
        d.addEventListener('click', ()=> handleClick(r,c));
        squares.push(d); boardEl.appendChild(d);
      }
      status('Click any square to place your knight and start.');
      updateHUD();
      renderBest();
    }

    function placeKnight(r,c){
      if(path.length===0){ startTime = Date.now(); timerId && clearInterval(timerId); timerId = setInterval(updateHUD, 300); bMode.textContent='Mode: Manual'; }
      current={r,c}; path.push({r,c}); visit[idx(r,c)] = path.length; squares[idx(r,c)].querySelector('.knight').textContent='â™ž'; squares[idx(r,c)].querySelector('.num').textContent=path.length;
      beep(720, .04, .04);
      drawPath(path);
      const next = legalMoves(r,c); clearHighlights(); next.forEach(m=> squares[idx(m.r,m.c)].classList.add('valid'));
      if(path.length===N*N){ finish(true); }
    }

    function moveKnight(r,c){
      if(!current){ placeKnight(r,c); return; }
      const lm = legalMoves(current.r, current.c).some(m=> m.r===r && m.c===c);
      if(!lm){
        const el = squares[idx(r,c)]; el.classList.add('bad'); setTimeout(()=> el.classList.remove('bad'), 300); beep(180, .06, .04); return;
      }
      squares[idx(current.r,current.c)].querySelector('.knight').textContent='';
      placeKnight(r,c);
    }

    function handleClick(r,c){
      if(animating) return;
      if(visit[idx(r,c)]!==-1){ showToast('Already visited'); return; }
      if(!current) { moveKnight(r,c); return; }
      moveKnight(r,c);
    }

    function undo(){ if(animating || path.length===0) return; const last = path.pop(); visit[idx(last.r,last.c)] = -1; squares[idx(last.r,last.c)].querySelector('.knight').textContent=''; squares[idx(last.r,last.c)].querySelector('.num').textContent=''; if(path.length){ current = path[path.length-1]; squares[idx(current.r,current.c)].querySelector('.knight').textContent='â™ž'; } else { current=null; startTime=0; clearInterval(timerId); bTime.textContent='Time: 00:00'; } clearHighlights(); if(current){ legalMoves(current.r,current.c).forEach(m=> squares[idx(m.r,m.c)].classList.add('valid')); } drawPath(path); updateHUD(); }

    function reset(){ animating=false; clearInterval(timerId); startTime=0; bTime.textContent='Time: 00:00'; drawBoard(); }

    function finish(won){ animating=false; clearInterval(timerId); if(won){ saveBest(); status('ðŸŽ‰ Tour complete!'); showToast('Tour complete!'); beep(880,.08,.05); beep(660,.08,.05); } updateHUD(); }

    // --- Path drawing ---
    function drawPath(p){ const step = 100/N; const pts = p.map(pt=>({x: pt.c*step + step/2, y: pt.r*step + step/2})); if(!pts.length){ pathSVG.innerHTML=''; return; } const d = pts.map((pt,i)=> i?`L ${pt.x} ${pt.y}`:`M ${pt.x} ${pt.y}`).join(' '); pathSVG.innerHTML = `<path d="${d}" />`; }

    // --- Solver ---
    function onwardDegree(r,c){ let cnt=0; for(const [dr,dc] of MOVES){ const nr=r+dr, nc=c+dc; if(inBounds(nr,nc) && visit[idx(nr,nc)]===-1) cnt++; } return cnt; }
    function nextMoves(r,c){ const arr=[]; for(const [dr,dc] of MOVES){ const nr=r+dr, nc=c+dc; if(inBounds(nr,nc) && visit[idx(nr,nc)]===-1){ arr.push({r:nr,c:nc,deg:onwardDegree(nr,nc)}); } } arr.sort((a,b)=> a.deg-b.deg); return arr; }

    function findTourFrom(startR,startC, strategy='warnsdorff'){
      // Local temp arrays separate from live state to avoid mutation while searching
      const used = Array(N*N).fill(false);
      const result=[];
      function dfs(r,c,step){ used[idx(r,c)] = true; result.push({r,c}); if(step===N*N) return true; let moves = MOVES.map(([dr,dc])=>({r:r+dr,c:c+dc})).filter(p=> inBounds(p.r,p.c) && !used[idx(p.r,p.c)]);
        if(strategy==='warnsdorff'){ moves = moves.map(m=> ({...m,deg: MOVES.reduce((acc,[dr,dc])=>{ const nr=m.r+dr, nc=m.c+dc; return acc + (inBounds(nr,nc) && !used[idx(nr,nc)] ? 1:0); },0)})).sort((a,b)=>a.deg-b.deg); }
        for(const m of moves){ if(dfs(m.r,m.c, step+1)) return true; }
        used[idx(r,c)] = false; result.pop(); return false; }
      if(dfs(startR,startC,1)) return result; return [];
    }

    function autoGenerate(){
      // Try current square, else try all squares until we find a tour
      status('Searching for tourâ€¦');
      let order=[];
      for(let r=0;r<N;r++) for(let c=0;c<N;c++) order.push({r,c});
      // Shift current to front if exists
      if(current){ order.sort((a,b)=> (a.r===current.r && a.c===current.c)?-1 : (b.r===current.r && b.c===current.c)?1 : 0); }
      const strategy = strategyEl.value;
      for(const s of order){ const sol = findTourFrom(s.r,s.c,strategy); if(sol.length){ autoSolution = sol; showToast(`Found tour from (${s.r+1},${s.c+1})`); status(`Tour found. Click "Play Auto Path" to watch, or "Reset" to try yourself.`); bMode.textContent='Mode: Auto'; return; } }
      status('No tour found (unexpected on 5Ã—5). Try again.');
    }

    async function playAuto(){ if(!autoSolution.length){ showToast('Generate a tour first'); return; } animating=true; reset(); // fresh board
      // Place and animate
      startTime = Date.now(); timerId = setInterval(updateHUD, 300); bMode.textContent='Mode: Auto';
      for(let i=0;i<autoSolution.length && animating;i++){
        const p = autoSolution[i];
        const el = squares[idx(p.r,p.c)];
        if(visit[idx(p.r,p.c)]!==-1){ // shouldn't happen on fresh board
          continue;
        }
        if(i>0){ squares[idx(autoSolution[i-1].r, autoSolution[i-1].c)].querySelector('.knight').textContent=''; }
        placeKnight(p.r,p.c);
        await new Promise(res=> setTimeout(res, +speedEl.value));
      }
      if(animating){ finish(true); }
      animating=false;
    }

    function keyHandler(e){ if(animating) return; if(!current) return; const map={ArrowUp:[-2,0], ArrowDown:[2,0], ArrowLeft:[0,-2], ArrowRight:[0,2]}; if(map[e.key]){ // arrow helper to hop two then one via hint squares
        // Not exact knight control; we still enforce legalMoves
      }
      // WASD doesn't directly map; ignore. Use mouse/tap.
    }

    // --- Wire up ---
    function newGame(){ reset(); showToast('New game started'); }

    btnNew.addEventListener('click', newGame);
    btnHint.addEventListener('click', ()=>{ if(!current){ showToast('Place the knight first'); return; } clearHighlights(); const m = legalMoves(current.r,current.c); m.forEach(p=> squares[idx(p.r,p.c)].classList.add('valid')); beep(520,.05,.04); status(`${m.length} legal moves highlighted.`); });
    btnUndo.addEventListener('click', undo);
    btnReset.addEventListener('click', reset);

    btnAuto.addEventListener('click', autoGenerate);
    btnPlay.addEventListener('click', playAuto);
    btnStop.addEventListener('click', ()=>{ animating=false; status('Stopped'); });
    btnSound.addEventListener('click', ()=>{ soundOn=!soundOn; btnSound.textContent = soundOn? 'ðŸ”ˆ Sound: On' : 'ðŸ”‡ Sound: Off'; });

    window.addEventListener('keydown', keyHandler);

    // Init
    drawBoard();
  </script>
</body>
</html>
